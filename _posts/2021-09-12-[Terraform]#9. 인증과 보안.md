---
title: '[terraform]#9.인증과 보안'
categories: [study]
comments: true
---

# 1. HTTPS

## HTTPS의 동작 방식

`HTTPS` 는 `HTTP`와 달리 통신 내용이 암호화되어 전달된다. 포트 펀호는 443번을 사용하고 TCP/IP에 5계층의 SSL/TLS를 적용하고 전자 인증서를 통해 통신 쌍방의 신뢰관계를 만든다. 도청이나 위변조를 막기 위해 API에는 기본적으로 HTTPS 프로토콜을 사용한다.

## 인증서

인증서는 서버 인증서와 클라이언트 인증서로 분류한다. 클라우드 환경에서는 클라우드의 신뢰성을 증명하기 위해 서버 인증서를 활용한다. 클라이언트 측에 대한 정보는 클라우드에서 제공하는 인증 기능을 사용하거나 HTTP 헤더의 유저 에이전트 정보들을 통해 알아낸다.<br>
통신 내용을 암복호화하려면 키가 필요한데, HTTPS는 공유 키 암호화 방식과 공개 키 암호화 방식을 조합한 하이브리드 암호화 방식을 사용한다. 처음에는 공유 키를 공개 키 암호화 방식으로 전달한 다음 전달된 공유 키를 사용해서 암호화 통신을 하게 된다. 클라우드의 엔드포인트에 서버 인증서가 설저오디어 있으므로 HTTPS로 API를 실행할 수 있다. 서버 인증서는 인증서의 사실상 표준인 Symantec사의 인증서를 사용하고, 이의 인증기관인 CA가 해당 도메인에 대한 신뢰 여부를 인증하게 된다. 이것은 서버의 URI에 대한 신뢰성을 인증하고, 접속하는 사용자를 인증하지는 않는다. 이는 뒤에서 알아보고,  한편 엔드포인트에 HTTPS가 적용되고 사용자 인증까지 더해지면 뒤에 설명할 `서명`프로세스가 가능해진다.


# 2. 사용자,그룹,롤,정책

사용자에 대한 인증을 처리하는 컴포넌트는 AWS에서는 IAM이 담당한다. 인증하는 단위와 권한 제어 방식에 대해 살펴보자.

## 테넌트

클라우드에는 최상위 개념으로 테넌트가 있다. 이 개념을 AWS에서는 어카운트라고 표현한다. 한 테넌트는 또 다른 테넌트와 완전히 격리되어 있다. 인증도 리소스의 하나이므로 적어도 하나의 테넌트에 반드시 속한다. 원칙적으로 여러 테넌트에 걸쳐서 인증하는 것을 불가능하다.

## 사용자

사용자는 API를 실행하게 만드는 사람을 의미한다. 사용자도 리소스 형태로 분류되어 API를 통해 생성, 변경, 삭제를 할 수 있다. 처음 클라우드 환경을 만들 때 리소스가 없으므로 사용자도 없는데, 클라우드를 어떻게 사용할까? 클라우드에는 테넌트와 연결된 특별한 관리자 계정이 있다. 리눅스에서는 root, 윈도우에서는 Administrator에 해당한다. 이는 권한이 막강해서 실제 운영시에는 사용하지 않는 것을 권장한다. AWS에서는 AWS 계정을 생성할 때 입력한 이메일 주소로 사용자를 식별하고 이를 기반으로 인증 정보를 다룬다. <br>
클라우드를 이용할 일반 사용자를 생성하는 방법은, AWS에서는 `CreateUser` API를 실행하면 된다. IAM이 리전에 속하지 않아서 리전 정보가 포함되어 있지 않은 https://iam.amazonaws.com/ 으로 실행해야 한다. 생성 직후에는 권한이 할당되지 않아 아무런 API도 실행시키지 못하므로 정책을 먼저 생성해줘야 한다.

## 그룹

