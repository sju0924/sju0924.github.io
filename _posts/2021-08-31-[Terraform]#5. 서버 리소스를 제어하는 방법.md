---
title: '[terraform]#5. 서버 리소스를 제어하는 방법'
categories: [study]
comments: true
---

# 1. 서버 리소스 제어를 위한 기본 API
## 서버 리소스
서버 리소스에는 `타입` 과 `이미지` 라는 구성 요소가 있다. `서버 리소스` 란 기동하거나 정지하는 서버를 의미하며, `인스턴스` 라 부르기도 한다. 
* `타입` 은 리소스의 크기나 속성을 몇 가지 유형으로 정리한 것이다. 아마존 EC2에서는 인스턴스 유형이라 한다.
* `이미지` 는 서버의 기동 이미지로, AWS에서는 AMI에 해당한다.

리소스들의 연관 관계를 정리해보자면 서버는 반드시 하나의 타입과 이미지로 생성되고, 반면 한 타입과 이미지는 여러 서버를 만들 때 사용될 수 있다.

## 서버 리소스와 API
URL 로 API 를 제어할 때, 각 리소스들에 부여된 고유 ID(대개 UUID) 를 URL 에 포함시켜 API 조건으로 지정하면 해당 리소스에만 API 가 동작하게 제어할 수 있다.

## 가상 서버 생성을 위한 API 처리 흐름
오픈스택 nova 명령의 흐름을 따라가면서 API 동작을 살펴보았다.
* 인증

>https://{identity}/v2.0/tokens

URI를 POST 방식으로 호출한다. {identity}에는 Keystone 서비스를 제공하는 서버의 접속 정보가 들어간다. 또 POST 로 전송된 데이터에는 인증에 필요한 username과 password 가들어있다. 이 API 요청이 성공하면 사용자에게 토큰과 엔드포인트에 대한 정보가 응답으로 돌아온다. `토큰` 은 인증 이후의 각종 처리를 할 때 때 인증 정보로 사용하는 문자열이다. `엔드포인트`는 API를 제공하는 서버의 접점을 URI 로 표현한 것이다. 오픈스택에서는 기능별로 API들이 분리되어 있고 서버도 분리되어 있다. 즉, 기능에 따라 엔드포인트도 다르다. `Keystone` 은 API의 접점 정보들을 엔드포인트로 관리한다. 그래서 사용자가 인증에 성공하면 접속할 엔드포인트를 알려준다. 그래서 인증 이후의 URL 호출을 살펴보면 {identity}가 {compute}로 바뀐다. 이 예에서는 가상 서버를 만드는 것이 목적이어서 서버 리소스를 관리하는 API 의 엔드포인트가 compute로 바뀐다.

* 템플릿 이미지의 유효성 검증

> https://{compute}/v2/{tenant_id}/images/{image_id}

URI 를 GET 방식으로 호출한다.